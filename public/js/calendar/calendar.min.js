var dc=0,hix=document.location.pathname.substring(document.location.pathname.lastIndexOf("/")+1),humanresources="calendar"===hix?0:hix,alertText="",calendar=function(){$("#calendar").fullCalendar({defaultDate:moment(),locale:timegrid.lang,editable:!0,aspectRatio:1.35,height:"auto",header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},defaultView:"agendaWeek",allDayDefault:!1,allDaySlot:!1,allDayText:"Asysta",businessHours:{start:timegrid.minTime,end:timegrid.maxTime,dow:[1,2,3,4,5,6]},views:{agendaWeek:{minTime:timegrid.minTime,maxTime:timegrid.maxTime,slotDuration:timegrid.slotDuration,slotLabelInterval:["01:00"],slotLabelFormat:["H:mm"]}},events:timegrid.events,selectable:!0,selectHelper:!0,scrollTime:moment().format("HH")+":00:00",select:function(e,t,n){if(0==dc){var a;if(0==humanresources)return alert(alertText,"error"),$("#calendar").fullCalendar("unselect"),-1;a={title:"Spotkanie",start:e,end:t},$("#exampleModal").modal({keyboard:!1,backdrop:!1}),$("#searchfield").val(""),$("#searchfield").focus(),$("#exampleModal").css("block")&&$("#calendar").fullCalendar("unselect"),dateAppo=a.start,changeDateAppo(e,t)}},dayClick:function(e,t,n){},eventClick:function(e,t,n){if(1==e.allDay)return $("#calendar").fullCalendar("removeEvents",e._id),asystaRemove(e.title,e.start._i),-1;$("#_modal_appocalendar").modal({keyboard:!1,backdrop:!1});var a=e.title.split("/");app_meeting_Id=e.id,$("#app-meeting-client").html("<a onclick='clickLink(this);' href='#'>"+a[0]+"</a>"),dateEventAppo=e.start;a=dateEventAppo._i.split("T");$("#app-meeting-date").html(a[0]+" "+a[1].split("+")[0].slice(0,-3)),$("#app-meeting-service").html(e.service),$("#app-meeting-staff").html(e.staff),$("#app-meeting-note").html(e.icon4.note||"")},eventDrop:function(t,n,e,a,i){confirm("Jesteś pewny(a) zmiany?",function(e){if(!e)return i(),!1;e=(n._data.days?864e5*n._data.days:0)+(n._data.hours?36e5*n._data.hours:0)+(n._data.minutes?6e4*n._data.minutes:0);return!!changeAppointmentLock&&(changeAppointmentLock=!1,AppointmentChange.endPoint="/bookchange",AppointmentChange.post={businessId:businessId,hr:humanresources,id:t.id,times:e,type:"a",csrf:csrf},AppointmentChange.get(function(e){alert(e.info),changeAppointmentLock=!0}),!0)})},eventResize:function(t,n,a){confirm("Jesteś pewny(a) zmiany?",function(e){if(!e)return a(),!1;e=n;return!!changeAppointmentLock&&(changeAppointmentLock=!1,AppointmentChange.endPoint="/bookchange",AppointmentChange.post={businessId:businessId,hr:humanresources,id:t.id,times:e._milliseconds,type:"f",csrf:csrf},AppointmentChange.get(function(e){alert(e.info),changeAppointmentLock=!0}),!0)})},eventRender:function(e,t){e.icon&&t.find(".fc-title").prepend("&nbsp;<i style='color:white;' class='fa fa-"+e.icon+" fa-1x' aria-hidden='true'></i>&nbsp;"),e.icon2&&t.find(".fc-title").prepend("&nbsp;<i style='color:white;' class='fa fa-"+e.icon2+" fa-1x' aria-hidden='true'></i>&nbsp;"),e.icon3&&t.find(".fc-title").prepend("&nbsp;<i style='color:white;' class='fa fa-"+e.icon3+" fa-1x' aria-hidden='true'></i>&nbsp;"),e.icon4&&t.find(".fc-title").prepend("&nbsp;<i style='color:white;' class='fa fa-"+e.icon4+" fa-1x' aria-hidden='true'></i>&nbsp;")}})},getAsystaCook=function(){for(var e="asysta=",t=decodeURIComponent(document.cookie).split(";"),n=0;n<t.length;n++){for(var a=t[n];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(e))return a.substring(e.length,a.length)}return""},asysta=function(e,t){t={title:e,allDay:!0,stick:!1,start:t,editable:!0,overlap:!1,backgroundColor:"#f1f1f1",textColor:"#000000"};timegrid.events.push(t),$("#calendar").fullCalendar("removeEvents"),$("#calendar").fullCalendar("addEventSource",timegrid.events)},asystaAdd=function(e,t){var n=new Date;n.setTime(n.getTime()+20736e5);var a="expires="+n.toUTCString(),n=getAsystaCook();document.cookie="asysta="+encodeURIComponent(n+e+","+t+"^")+";"+a+";path=/"},asystaRemove=function(e,t){var n="",a=getAsystaCook();if(a){a=a.split("^");for(var i=0;i<a.length-1;i++)who=a[i].split(","),who[0]==e&&who[1]==t||(n+=who[0]+","+who[1]+"^")}var o=new Date;o.setTime(o.getTime()+20736e5);o="expires="+o.toUTCString();document.cookie="asysta="+encodeURIComponent(n)+";"+o+";path=/"};