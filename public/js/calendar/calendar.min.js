var dc=0,hix=document.location.pathname.substring(document.location.pathname.lastIndexOf("/")+1),humanresources="calendar"===hix?0:hix,calendar=function(){$("#calendar").fullCalendar({defaultDate:moment(),locale:timegrid.lang,editable:!0,aspectRatio:1.35,height:"auto",header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},defaultView:"agendaWeek",allDayDefault:!1,allDaySlot:!1,allDayText:"Asysta",businessHours:{start:timegrid.minTime,end:timegrid.maxTime,dow:[1,2,3,4,5,6]},views:{agendaWeek:{minTime:timegrid.minTime,maxTime:timegrid.maxTime,slotDuration:timegrid.slotDuration,slotLabelInterval:["01:00"],slotLabelFormat:["H:mm"]}},events:timegrid.events,selectable:!0,selectHelper:!0,scrollTime:moment().format("HH")+":00:00",select:function(e,t,a){if(0==dc){if(0==humanresources){return alert("Wybierz kalendarz pracownika","error"),$("#calendar").fullCalendar("unselect"),-1}var n;n={title:"Spotkanie",start:e,end:t},$("#exampleModal").modal({keyboard:!1,backdrop:!1}),$("#searchfield").val(""),$("#searchfield").focus(),$("#exampleModal").css("block")&&$("#calendar").fullCalendar("unselect"),dateAppo=n.start,changeDateAppo(e,t)}},dayClick:function(e,t,a){},eventClick:function(e,t,a){if(1==e.allDay)return $("#calendar").fullCalendar("removeEvents",e._id),asystaRemove(e.title,e.start._i),-1;$("#_modal_appocalendar").modal({keyboard:!1,backdrop:!1});var n=e.title.split("/");app_meeting_Id=e.id,$("#app-meeting-client").html("<a onclick='clickLink(this);' href='#'>"+n[0]+"</a>"),dateEventAppo=e.start;var i=dateEventAppo._i.split("T");$("#app-meeting-date").html(i[0]+" "+i[1].split("+")[0].slice(0,-3)),$("#app-meeting-service").html(e.service),$("#app-meeting-staff").html(e.staff),$("#app-meeting-note").html(e.icon4.note?e.icon4.note:"")},eventDrop:function(a,e,t,n,i){var o=e;if(console.log(e),AppointmentChange.endPoint="/bookchange",!0===a.allDay)return changeAppointmentLock=!0,i(),-1;confirm("Jesteś pewny(a) zmiany?",function(e){if(!e)return i(),!1;var t;return t=(o._data.days?864e5*o._data.days:0)+(o._data.hours?36e5*o._data.hours:0)+(o._data.minutes?6e4*o._data.minutes:0),AppointmentChange.post={businessId:businessId,hr:humanresources,id:a.id,times:t,type:"a",csrf:csrf},!!changeAppointmentLock&&(changeAppointmentLock=!1,AppointmentChange.get(function(e){alert(e.info),changeAppointmentLock=!0}),!0)})},eventResize:function(a,n,i){confirm("Jesteś pewny(a) zmiany?",function(e){if(!e)return i(),!1;var t=n;return AppointmentChange.endPoint="/bookchange",AppointmentChange.post={businessId:businessId,hr:humanresources,id:a.id,times:t._milliseconds,type:"f",csrf:csrf},!!changeAppointmentLock&&(changeAppointmentLock=!1,AppointmentChange.get(function(e){alert(e.info),changeAppointmentLock=!0}),!0)})},eventRender:function(e,t){e.icon&&t.find(".fc-title").prepend("&nbsp;<i style='color:white;' class='fa fa-"+e.icon+" fa-1x' aria-hidden='true'></i>&nbsp;"),e.icon2&&t.find(".fc-title").prepend("&nbsp;<i style='color:white;' class='fa fa-"+e.icon2+" fa-1x' aria-hidden='true'></i>&nbsp;"),e.icon3&&t.find(".fc-title").prepend("&nbsp;<i style='color:white;' class='fa fa-"+e.icon3+" fa-1x' aria-hidden='true'></i>&nbsp;"),e.icon4&&t.find(".fc-title").prepend("&nbsp;<i style='color:white;' class='fa fa-"+e.icon4+" fa-1x' aria-hidden='true'></i>&nbsp;")}})},getAsystaCook=function(){for(var e="asysta=",t=decodeURIComponent(document.cookie).split(";"),a=0;a<t.length;a++){for(var n=t[a];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(e))return n.substring(e.length,n.length)}return""},asysta=function(e,t){var a={title:e,allDay:!0,stick:!1,start:t,editable:!0,overlap:!1,backgroundColor:"#f1f1f1",textColor:"#000000"};timegrid.events.push(a),$("#calendar").fullCalendar("removeEvents"),$("#calendar").fullCalendar("addEventSource",timegrid.events)},asystaAdd=function(e,t){var a=new Date;a.setTime(a.getTime()+20736e5);var n="expires="+a.toUTCString(),i=getAsystaCook();document.cookie="asysta="+encodeURIComponent(i+e+","+t+"^")+";"+n+";path=/"},asystaRemove=function(e,t){var a="",n=getAsystaCook();if(n){n=n.split("^");for(var i=0;i<n.length-1;i++)who=n[i].split(","),who[0]==e&&who[1]==t||(a+=who[0]+","+who[1]+"^")}var o=new Date;o.setTime(o.getTime()+20736e5);var r="expires="+o.toUTCString();document.cookie="asysta="+encodeURIComponent(a)+";"+r+";path=/"};